<html>
<head>
  <title>shell自动部署trans-war.sh</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="479"/>
<h1>shell自动部署trans-war.sh</h1>

<div><span><div><div><div>trans-war.sh:</div><div><br/></div><div>set -x           #开启日志输出</div><div>set -e           # <font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">若指令传回值不等于0，则立即退出shell</span></font></div><div>mvn clean install -DskipTests    #maven项目可用此打包</div><div>chmod 766 &quot;./target/tobacco.war&quot; </div><div>scp -p ./target/tobacco.war root@120.26.94.208:/home/gztf/deploy/ROOT.war  #将war包传到远程服务器</div><div>chmod 766 ./deploy.sh</div><div>scp -p ./deploy.sh root@120.26.94.208:/home/gztf/deploy/</div><div>ssh root@120.26.94.208 &quot;chmod +x /home/gztf/deploy/deploy.sh&quot;</div><div>ssh root@120.26.94.208 &quot;/home/gztf/deploy/deploy.sh&quot;</div><div><br/></div><div>deploy.sh:</div><div><br/></div><div>#!/bin/bash</div><div>#filename deploy.sh</div><div>set -x              #开启日志输出</div><div>export TOMCAT_HOME=/home/gztf/apache-tomcat-7.0.42    #设置tomcat目录路径</div><div>weixin_pid=$(ps -ef|grep tomcat|awk '{print $2}')   #处理现有tomcat进程</div><div>for temp_pid in ${weixin_pid}</div><div>do </div><div>    kill -9 ${temp_pid}</div><div>done</div><div><br/></div><div>war_file=&quot;/home/gztf/deploy/ROOT.war&quot;</div><div>if [ -f &quot;$war_file&quot; ];</div><div>then</div><div>    echo &quot;War file exists, deploy and start the server.&quot;</div><div>    #restart tomcat</div><div>    rm -rf ${TOMCAT_HOME}/webapps/ROOT/</div><div>    rm -f ${TOMCAT_HOME}/webapps/ROOT.war</div><div>    cp  ${war_file} ${TOMCAT_HOME}/webapps/ROOT.war</div><div>    /bin/bash ${TOMCAT_HOME}/bin/startup.sh</div><div>    #remove war file.</div><div>    rm ${war_file}</div><div>else</div><div>    echo &quot;War file not exists, restart the server.&quot;</div><div>    /bin/bash ${TOMCAT_HOME}/bin/startup.sh</div><div>fi</div><div>set +x</div><div>tailf -300 /home/logs/tobacco_default_log.log</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><a href="shell自动部署trans-war.sh_files/trans-war.sh"><img src="shell自动部署trans-war.sh_files/c66969408950a70f90576da20994d6e8.png" alt="trans-war.sh"></a><a href="shell自动部署trans-war.sh_files/deploy.sh"><img src="shell自动部署trans-war.sh_files/b2cafc1ed338b756dea9963ca3e55cfb.png" alt="deploy.sh"></a></div><div><br/></div><div><br/></div><div>附shell set语句</div><div><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">set指令能设置所使用shell的执行方式，可依照不同的需求来做设置</span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-a 　标示已修改的变量，以供输出至环境变量。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-b 　使被中止的后台程序立刻回报执行状态。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-C 　转向所产生的文件无法覆盖已存在的文件。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-d 　Shell预设会用杂凑表记忆使用过的指令，以加速指令的执行。使用-d参数可取消。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-e 　若指令传回值不等于0，则立即退出shell。　　 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-f　 　取消使用通配符。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-h 　自动记录函数的所在位置。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-H Shell 　可利用&quot;!&quot;加&lt;指令编号&gt;的方式来执行history中记录的指令。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-k 　指令所给的参数都会被视为此指令的环境变量。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-l 　记录for循环的变量名称。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-m 　使用监视模式。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-n 　只读取指令，而不实际执行。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-p 　启动优先顺序模式。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-P 　启动-P参数后，执行指令时，会以实际的文件或目录来取代符号连接。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-t 　执行完随后的指令，即退出shell。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-u 　当执行时使用到未定义过的变量，则显示错误信息。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-v 　显示shell所读取的输入值。 </span></font><br/><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　-x 　执行指令后，会先显示该指令及所下的参数。 </span></font></div><div><font color="rgb(0,0,0)" face="Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif"><span style="text-transform: none; text-indent: 0px; letter-spacing: normal; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;">　+&lt;参数&gt; 　取消某个set曾启动的参数。</span></font></div><div><br/></div><div><br/></div></div></div></span>
</div></body></html> 