<html>
<head>
  <title>log4j配置文件</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="404"/>
<h1>log4j配置文件</h1>

<div><span><div></div><div style="font: bold 13px/26px Arial; text-align: left; color: rgb(51, 51, 51); text-transform: none; text-indent: 0px; letter-spacing: normal; margin-bottom: 10px; word-spacing: 0px; white-space: normal; widows: 1; font-size-adjust: none; font-stretch: normal; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;"><a href="http://www.blogjava.net/kit-soft/archive/2009/08/28/292977.html" style="color: rgb(86, 182, 233); font-size: 13px; text-decoration: none;">log4j配置祥解</a></div><div style="font: 12px/26px Arial; text-align: left; color: rgb(51, 51, 51); text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; widows: 1; font-size-adjust: none; font-stretch: normal; background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0px;"><font face="宋体"><span style="line-height: 1.3em;">第一步：加入log4j-1.2.8.jar到lib下。</span></font><br/><br/><font face="宋体"><span style="line-height: 1.3em;">第二步：在CLASSPATH下建立log4j.properties。内容如下：</span></font><br/><br/>l###setloglevels###<br/>log4j.rootLogger=info,stdout,D,E<br/><br/>###输出到控制台###<br/>log4j.appender.stdout = org.apache.log4j.ConsoleAppender<br/>log4j.appender.stdout.Target = System.out<br/>log4j.appender.stdout.layout = org.apache.log4j.PatternLayout<br/>log4j.appender.stdout.layout.ConversionPattern =  %d [%t] %-5p [%c] - %m%n<br/>log4j.appender.stdout.Encoding=UTF-8<br/><br/>### 输出到日志文件 ###<br/>log4j.appender.D = org.apache.log4j.DailyRollingFileAppender<br/>##${webapp.root}的值为应用所在的路径<br/>log4j.appender.D.File = ${webapp.root}/logs/log.log<br/>log4j.appender.D.Append = true<br/>## 输出DEBUG级别以上的日志<br/>log4j.appender.D.Threshold = DEBUG <br/>log4j.appender.D.layout = org.apache.log4j.PatternLayout<br/>log4j.appender.D.layout.ConversionPattern = %d [%t] %-5p [%c] - %m%n<br/>log4j.appender.D.Encoding=UTF-8<br/><br/>### 保存异常信息到单独文件 ###<br/>log4j.appender.E = org.apache.log4j.DailyRollingFileAppender<br/>## 异常日志文件名<br/>log4j.appender.E.File =  ${webapp.root}/logs/error.log <br/>log4j.appender.E.Append = true<br/>## 只输出ERROR级别以上的日志!!!<br/>log4j.appender.E.Threshold = ERROR <br/>log4j.appender.E.layout = org.apache.log4j.PatternLayout<br/>log4j.appender.E.layout.ConversionPattern = %d [%t] %-5p [%c] - %m%n<br/>log4j.appender.E.Encoding=UTF-8<br/><br/><font face="宋体"><span style="line-height: 1.3em;">第三步：相应的修改其中属性，修改之前就必须知道这些都是干什么的，在第二部分讲解。</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">第四步：在要输出日志的类中加入相关语句：</span></font><br/><br/><font face="宋体"><span style="line-height: 1.3em;">定义属性：protected final Log log = LogFactory.getLog(getClass());</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">在相应的方法中：</span></font><br/>if (log.isDebugEnabled())<br/>{<br/>log.debug(“System …..”);<br/>}<br/><br/><font face="宋体"><span style="line-height: 1.3em;">二、Log4j说明</span></font><br/>log4j.rootCategory=INFO, stdout , R<br/><font face="宋体"><span style="line-height: 1.3em;">此句为将等级为INFO的日志信息输出到stdout和R这两个目的地，stdout和R的定义在下面的代码，可以任意起名。等级可分为OFF、 FATAL、ERROR、WARN、INFO、DEBUG、ALL，如果配置OFF则不打出任何信息，如果配置为INFO这样只显示INFO, WARN, ERROR的log信息，而DEBUG信息不会被显示，具体讲解可参照第三部分定义配置文件中的logger。</span></font><br/> log4j.appender.stdout=org.apache.log4j.ConsoleAppender<br/><font face="宋体"><span style="line-height: 1.3em;">此句为定义名为stdout的输出端是哪种类型，可以是</span></font><br/>org.apache.log4j.ConsoleAppender<font face="宋体"><span style="line-height: 1.3em;">（控制台），</span></font><br/>org.apache.log4j.FileAppender<font face="宋体"><span style="line-height: 1.3em;">（文件），</span></font><br/>org.apache.log4j.DailyRollingFileAppender<font face="宋体"><span style="line-height: 1.3em;">（每天产生一个日志文件），</span></font><br/>org.apache.log4j.RollingFileAppender<font face="宋体"><span style="line-height: 1.3em;">（文件大小到达指定尺寸的时候产生一个新的文件）</span></font><br/>org.apache.log4j.WriterAppender<font face="宋体"><span style="line-height: 1.3em;">（将日志信息以流格式发送到任意指定的地方）</span></font><br/><br/><font face="宋体"><span style="line-height: 1.3em;">具体讲解可参照第三部分定义配置文件中的Appender。</span></font><br/>log4j.appender.stdout.layout=org.apache.log4j.PatternLayout<br/><font face="宋体"><span style="line-height: 1.3em;">此句为定义名为stdout的输出端的layout是哪种类型，可以是</span></font><br/>org.apache.log4j.HTMLLayout<font face="宋体"><span style="line-height: 1.3em;">（以HTML表格形式布局），</span></font><br/>org.apache.log4j.PatternLayout<font face="宋体"><span style="line-height: 1.3em;">（可以灵活地指定布局模式），</span></font><br/>org.apache.log4j.SimpleLayout<font face="宋体"><span style="line-height: 1.3em;">（包含日志信息的级别和信息字符串），</span></font><br/>org.apache.log4j.TTCCLayout<font face="宋体"><span style="line-height: 1.3em;">（包含日志产生的时间、线程、类别等等信息）</span></font><br/><br/><font face="宋体"><span style="line-height: 1.3em;">具体讲解可参照第三部分定义配置文件中的Layout。</span></font><br/>log4j.appender.stdout.layout.ConversionPattern= [QC] %p [%t] %C.%M(%L) | %m%n<br/><font face="宋体"><span style="line-height: 1.3em;">如果使用pattern布局就要指定的打印信息的具体格式ConversionPattern，打印参数如下：</span></font><br/>%m <font face="宋体"><span style="line-height: 1.3em;">输出代码中指定的消息</span></font><br/>%p <font face="宋体"><span style="line-height: 1.3em;">输出优先级，即DEBUG，INFO，WARN，ERROR，FATAL</span></font><br/>%r <font face="宋体"><span style="line-height: 1.3em;">输出自应用启动到输出该log信息耗费的毫秒数</span></font><br/>%c <font face="宋体"><span style="line-height: 1.3em;">输出所属的类目，通常就是所在类的全名</span></font><br/>%t <font face="宋体"><span style="line-height: 1.3em;">输出产生该日志事件的线程名</span></font><br/>%n <font face="宋体"><span style="line-height: 1.3em;">输出一个回车换行符，Windows平台为“rn”，Unix平台为“n”</span></font><br/>%d <font face="宋体"><span style="line-height: 1.3em;">输出日志时间点的日期或时间，默认格式为ISO8601，也可以在其后指定格式，比如：%d{yyyy MMM dd HH:mm:ss,SSS}，输出类似：2002年10月18日 22：10：28，921</span></font><br/>%l <font face="宋体"><span style="line-height: 1.3em;">输出日志事件的发生位置，包括类目名、发生的线程，以及在代码中的行数。</span></font><br/>[QC]<font face="宋体"><span style="line-height: 1.3em;">是log信息的开头，可以为任意字符，一般为项目简称。</span></font><br/><br/><font face="宋体"><span style="line-height: 1.3em;">输出的信息</span></font><br/>[TS] DEBUG [main] AbstractBeanFactory.getBean(189) | Returning cached instance of singleton bean 'MyAutoProxy'<br/><font face="宋体"><span style="line-height: 1.3em;">具体讲解可参照第三部分定义配置文件中的格式化日志信息。</span></font><br/> log4j.appender.R=org.apache.log4j.DailyRollingFileAppender<br/><font face="宋体"><span style="line-height: 1.3em;">此句与第3行一样。定义名为R的输出端的类型为每天产生一个日志文件。</span></font><br/> log4j.appender.R.File=D:\Tomcat 5.5\logs\qc.log<br/><font face="宋体"><span style="line-height: 1.3em;">此句为定义名为R的输出端的文件名为D:\Tomcat 5.5\logs\qc.log</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">可以自行修改。</span></font><br/>log4j.appender.R.layout=org.apache.log4j.PatternLayout<br/><font face="宋体"><span style="line-height: 1.3em;">与第4行相同。</span></font><br/>log4j.appender.R.layout.ConversionPattern=%d-[TS] %p %t %c - %m%n<br/><font face="宋体"><span style="line-height: 1.3em;">与第5行相同。</span></font><br/>log4j.logger.com. neusoft =DEBUG<br/><font face="宋体"><span style="line-height: 1.3em;">指定com.neusoft包下的所有类的等级为DEBUG。</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">可以把com.neusoft改为自己项目所用的包名。</span></font><br/>log4j.logger.com.opensymphony.oscache=ERROR<br/> log4j.logger.net.sf.navigator=ERROR<br/><font face="宋体"><span style="line-height: 1.3em;">这两句是把这两个包下出现的错误的等级设为ERROR，如果项目中没有配置EHCache，则不需要这两句。</span></font><br/>log4j.logger.org.apache.commons=ERROR<br/> log4j.logger.org.apache.struts=WARN<br/><font face="宋体"><span style="line-height: 1.3em;">这两句是struts的包。</span></font><br/> log4j.logger.org.displaytag=ERROR<br/><font face="宋体"><span style="line-height: 1.3em;">这句是displaytag的包。（QC问题列表页面所用）</span></font><br/>log4j.logger.org.springframework=DEBUG<br/><font face="宋体"><span style="line-height: 1.3em;">此句为Spring的包。</span></font><br/> log4j.logger.org.hibernate.ps.PreparedStatementCache=WARN<br/>log4j.logger.org.hibernate=DEBUG<br/><font face="宋体"><span style="line-height: 1.3em;">此两句是hibernate的包。</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">以上这些包的设置可根据项目的实际情况而自行定制。</span></font><br/><br/><font face="宋体"><span style="line-height: 1.3em;">三、log4j详解</span></font><br/><br/>1<font face="宋体"><span style="line-height: 1.3em;">、定义配置文件</span></font><br/>Log4j<font face="宋体"><span style="line-height: 1.3em;">支持两种配置文件格式，一种是XML格式的文件，一种是Java特性文件log4j.properties（键=值）。下面将介绍使用log4j.properties文件作为配置文件的方法:</span></font><br/><br/>①<font face="宋体"><span style="line-height: 1.3em;">、配置根Logger</span></font><br/>Logger <font face="宋体"><span style="line-height: 1.3em;">负责处理日志记录的大部分操作。</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">其语法为：</span></font><br/>log4j.rootLogger = [ level ] , appenderName, appenderName, …<br/><font face="宋体"><span style="line-height: 1.3em;">其中，level 是日志记录的优先级，分为OFF、FATAL、ERROR、WARN、INFO、DEBUG、ALL或者自定义的级别。Log4j建议只使用四个级别，优 先级从高到低分别是ERROR、WARN、INFO、DEBUG。通过在这里定义的级别，您可以控制到应用程序中相应级别的日志信息的开关。比如在这里定 义了INFO级别，只有等于及高于这个级别的才进行处理，则应用程序中所有DEBUG级别的日志信息将不被打印出来。ALL:打印所有的日志，OFF：关 闭所有的日志输出。 appenderName就是指定日志信息输出到哪个地方。可同时指定多个输出目的地。</span></font><br/>②<font face="宋体"><span style="line-height: 1.3em;">、配置日志信息输出目的地 Appender</span></font><br/>Appender <font face="宋体"><span style="line-height: 1.3em;">负责控制日志记录操作的输出。</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">其语法为：</span></font><br/>log4j.appender.appenderName = fully.qualified.name.of.appender.class<br/>log4j.appender.appenderName.option1 = value1<br/>…<br/>log4j.appender.appenderName.optionN = valueN<br/><br/><font face="宋体"><span style="line-height: 1.3em;">这里的appenderName为在①里定义的，可任意起名。</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">其中，Log4j提供的appender有以下几种：</span></font><br/>org.apache.log4j.ConsoleAppender<font face="宋体"><span style="line-height: 1.3em;">（控制台），</span></font><br/>org.apache.log4j.FileAppender<font face="宋体"><span style="line-height: 1.3em;">（文件），</span></font><br/>org.apache.log4j.DailyRollingFileAppender<font face="宋体"><span style="line-height: 1.3em;">（每天产生一个日志文件），</span></font><br/>org.apache.log4j.RollingFileAppender<font face="宋体"><span style="line-height: 1.3em;">（文件大小到达指定尺寸的时候产生一个新的文件），可通过 log4j.appender.R.MaxFileSize=100KB设置文件大小，还可通过 log4j.appender.R.MaxBackupIndex=1设置为保存一个备份文件。</span></font><br/>org.apache.log4j.WriterAppender<font face="宋体"><span style="line-height: 1.3em;">（将日志信息以流格式发送到任意指定的地方）</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">例如：log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">定义一个名为stdout的输出目的地，ConsoleAppender为控制台。</span></font><br/>③<font face="宋体"><span style="line-height: 1.3em;">、配置日志信息的格式（布局）Layout</span></font><br/>Layout <font face="宋体"><span style="line-height: 1.3em;">负责格式化Appender的输出。</span></font><br/><font face="宋体"><span style="line-height: 1.3em;">其语法为：</span></font><br/>log4j.appender.appenderName.layout = fully.qualified.name.of.layout.class<br/>log4j.appender.appenderName.layout.option1 = value1<br/>…<br/>log4j.appender.appenderName.layout.optionN = valueN<br/><font face="宋体"><span style="line-height: 1.3em;">其中，Log4j提供的layout有以下几种：</span></font><br/>org.apache.log4j.HTMLLayout<font face="宋体"><span style="line-height: 1.3em;">（以HTML表格形式布局），</span></font><br/>org.apache.log4j.PatternLayout<font face="宋体"><span style="line-height: 1.3em;">（可以灵活地指定布局模式），</span></font><br/>org.apache.log4j.SimpleLayout<font face="宋体"><span style="line-height: 1.3em;">（包含日志信息的级别和信息字符串），</span></font><br/>org.apache.log4j.TTCCLayout<font face="宋体"><span style="line-height: 1.3em;">（包含日志产生的时间、线程、类别等等信息）</span></font><br/><br/>2<font face="宋体"><span style="line-height: 1.3em;">、格式化日志信息</span></font><br/>Log4J<font face="宋体"><span style="line-height: 1.3em;">采用类似C语言中的printf函数的打印格式格式化日志信息，打印参数如下：</span></font><br/>%m <font face="宋体"><span style="line-height: 1.3em;">输出代码中指定的消息</span></font><br/>%p <font face="宋体"><span style="line-height: 1.3em;">输出优先级，即DEBUG，INFO，WARN，ERROR，FATAL</span></font><br/>%r <font face="宋体"><span style="line-height: 1.3em;">输出自应用启动到输出该log信息耗费的毫秒数</span></font><br/>%c <font face="宋体"><span style="line-height: 1.3em;">输出所属的类目，通常就是所在类的全名</span></font><br/>%t <font face="宋体"><span style="line-height: 1.3em;">输出产生该日志事件的线程名</span></font><br/>%n <font face="宋体"><span style="line-height: 1.3em;">输出一个回车换行符，Windows平台为“rn”，Unix平台为“n”</span></font><br/>%d <font face="宋体"><span style="line-height: 1.3em;">输出日志时间点的日期或时间，默认格式为ISO8601，也可以在其后指定格式，比如：%d{yyyy MMM dd HH:mm:ss,SSS}，输出类似：2002年10月18日 22：10：28，921</span></font><br/>%l <font face="宋体"><span style="line-height: 1.3em;">输出日志事件的发生位置，包括类目名、发生的线程，以及在代码中的行数。</span></font><br/>3<font face="宋体"><span style="line-height: 1.3em;">、在代码中使用Log4j</span></font><br/><br/><font face="宋体"><span style="line-height: 1.3em;">我们在需要输出日志信息的类中做如下的三个工作：</span></font><br/><br/>1<font face="宋体"><span style="line-height: 1.3em;">、导入所有需的commongs-logging类：</span></font><br/><br/>import org.apache.commons.logging.Log;<br/>import org.apache.commons.logging.LogFactory;<br/><br/>2<font face="宋体"><span style="line-height: 1.3em;">、在自己的类中定义一个org.apache.commons.logging.Log类的私有静态类成员：</span></font><br/>private final Log log = LogFactory.getLog(getClass());<br/>LogFactory.getLog()<font face="宋体"><span style="line-height: 1.3em;">方法的参数使用的是当前类的class。</span></font><br/><br/>3<font face="宋体"><span style="line-height: 1.3em;">、使用org.apache.commons.logging.Log类的成员方法输出日志信息：</span></font><br/><br/>if (log.isDebugEnabled())<br/>{<br/>log.debug(&quot;111&quot;);<br/>}<br/>if (log.isInfoEnabled())<br/>{<br/>log.info(&quot;222&quot;);<br/>}<br/>if (log.isWarnEnabled())<br/>{<br/>log.warn(&quot;333&quot;);<br/>}<br/>if (log.isErrorEnabled())<br/>{<br/>log.error(&quot;444&quot;);<br/>}<br/>if (log.isFatalEnabled())<br/>{<br/>log.fatal(&quot;555&quot;)<br/>}</div></span>
</div></body></html> 